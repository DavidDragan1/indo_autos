<!-- breadcumb_search-area start  -->
<div class="d-none d-lg-block">
    <?php include_once dirname(APPPATH) . "/application/views/frontend/new/template/global_search.php"; ?>
</div>
<!-- breadcumb_search-area end  -->
<span class="category-filtar">
    <svg width="17" height="15" viewBox="0 0 17 15" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M0.53575 2.67825H0.611826C0.728765 3.1377 0.995454 3.54509 1.36976 3.83606C1.74407 4.12703 2.20465 4.285 2.67875 4.285C3.15285 4.285 3.61343 4.12703 3.98774 3.83606C4.36205 3.54509 4.62873 3.1377 4.74567 2.67825H15.5367C15.6788 2.67825 15.8151 2.6218 15.9156 2.52133C16.0161 2.42086 16.0725 2.28459 16.0725 2.1425C16.0725 2.00041 16.0161 1.86414 15.9156 1.76367C15.8151 1.66319 15.6788 1.60675 15.5367 1.60675H4.74567C4.62873 1.1473 4.36205 0.739907 3.98774 0.448935C3.61343 0.157964 3.15285 0 2.67875 0C2.20465 0 1.74407 0.157964 1.36976 0.448935C0.995454 0.739907 0.728765 1.1473 0.611826 1.60675H0.53575C0.39366 1.60675 0.25739 1.66319 0.156918 1.76367C0.0564449 1.86414 0 2.00041 0 2.1425C0 2.28459 0.0564449 2.42086 0.156918 2.52133C0.25739 2.6218 0.39366 2.67825 0.53575 2.67825ZM2.67875 1.071C2.89067 1.071 3.09784 1.13384 3.27404 1.25158C3.45025 1.36932 3.58759 1.53666 3.66869 1.73245C3.74979 1.92824 3.77101 2.14369 3.72966 2.35154C3.68832 2.55939 3.58627 2.75031 3.43641 2.90016C3.28656 3.05002 3.09564 3.15207 2.88779 3.19341C2.67994 3.23475 2.4645 3.21354 2.2687 3.13244C2.07291 3.05134 1.90557 2.914 1.78783 2.73779C1.67009 2.56158 1.60725 2.35442 1.60725 2.1425C1.60725 1.85832 1.72014 1.58578 1.92108 1.38483C2.12203 1.18389 2.39457 1.071 2.67875 1.071ZM15.5367 6.96425H15.4607C15.3437 6.5048 15.077 6.09741 14.7027 5.80644C14.3284 5.51546 13.8678 5.3575 13.3937 5.3575C12.9197 5.3575 12.4591 5.51546 12.0848 5.80644C11.7105 6.09741 11.4438 6.5048 11.3268 6.96425H0.53575C0.39366 6.96425 0.25739 7.02069 0.156918 7.12117C0.0564449 7.22164 0 7.35791 0 7.5C0 7.64209 0.0564449 7.77836 0.156918 7.87883C0.25739 7.9793 0.39366 8.03575 0.53575 8.03575H11.3268C11.4438 8.4952 11.7105 8.90259 12.0848 9.19356C12.4591 9.48454 12.9197 9.6425 13.3937 9.6425C13.8678 9.6425 14.3284 9.48454 14.7027 9.19356C15.077 8.90259 15.3437 8.4952 15.4607 8.03575H15.5367C15.6788 8.03575 15.8151 7.9793 15.9156 7.87883C16.0161 7.77836 16.0725 7.64209 16.0725 7.5C16.0725 7.35791 16.0161 7.22164 15.9156 7.12117C15.8151 7.02069 15.6788 6.96425 15.5367 6.96425ZM13.3937 8.5715C13.1818 8.5715 12.9747 8.50866 12.7985 8.39092C12.6222 8.27318 12.4849 8.10584 12.4038 7.91004C12.3227 7.71425 12.3015 7.49881 12.3428 7.29096C12.3842 7.08311 12.4862 6.89219 12.6361 6.74233C12.7859 6.59248 12.9769 6.49043 13.1847 6.44909C13.3926 6.40774 13.608 6.42896 13.8038 6.51006C13.9996 6.59116 14.1669 6.7285 14.2847 6.90471C14.4024 7.08091 14.4652 7.28808 14.4652 7.5C14.4652 7.78418 14.3524 8.05672 14.1514 8.25766C13.9505 8.45861 13.6779 8.5715 13.3937 8.5715ZM15.5367 12.3217H10.1032C9.98623 11.8623 9.71955 11.4549 9.34524 11.1639C8.97093 10.873 8.51035 10.715 8.03625 10.715C7.56215 10.715 7.10157 10.873 6.72726 11.1639C6.35295 11.4549 6.08627 11.8623 5.96933 12.3217H0.53575C0.39366 12.3217 0.25739 12.3782 0.156918 12.4787C0.0564449 12.5791 0 12.7154 0 12.8575C0 12.9996 0.0564449 13.1359 0.156918 13.2363C0.25739 13.3368 0.39366 13.3933 0.53575 13.3933H5.96933C6.08627 13.8527 6.35295 14.2601 6.72726 14.5511C7.10157 14.842 7.56215 15 8.03625 15C8.51035 15 8.97093 14.842 9.34524 14.5511C9.71955 14.2601 9.98623 13.8527 10.1032 13.3933H15.5367C15.6788 13.3933 15.8151 13.3368 15.9156 13.2363C16.0161 13.1359 16.0725 12.9996 16.0725 12.8575C16.0725 12.7154 16.0161 12.5791 15.9156 12.4787C15.8151 12.3782 15.6788 12.3217 15.5367 12.3217ZM8.03625 13.929C7.82433 13.929 7.61716 13.8662 7.44096 13.7484C7.26475 13.6307 7.12741 13.4633 7.04631 13.2675C6.96521 13.0718 6.94399 12.8563 6.98534 12.6485C7.02668 12.4406 7.12873 12.2497 7.27858 12.0998C7.42844 11.95 7.61936 11.8479 7.82721 11.8066C8.03506 11.7652 8.2505 11.7865 8.44629 11.8676C8.64209 11.9487 8.80943 12.086 8.92717 12.2622C9.04491 12.4384 9.10775 12.6456 9.10775 12.8575C9.10775 13.1417 8.99486 13.4142 8.79391 13.6152C8.59297 13.8161 8.32043 13.929 8.03625 13.929Z" fill="#F05C26"/>
    </svg>
    <span>Filter</span>
</span>
<!-- search_post-area start  -->
<div class="search_post-area pb-75 ">
    <div class="container">
        <div class="row">
            <div class="col-xl-3 col-lg-4 col-12 responsive-filtar-wrap">
                <aside class="search_post-sidebar ">
                    <div class="wrapper-filtar">
                        <span class="close-filtar">
                            <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 1L1 14M1 1L14 14" stroke="#F05C26" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </span>
                        <form class="post-search" action="buy/car/search" method="get">
                            <div class="input-field input-password">
                                <input name="global_search" value="<?=@$_GET['global_search']?>" type="text" required
                                    placeholder="Search Make, Model, Location">

                                <button type="submit" class="material-icons">search</button>
                            </div>
                        </form>
                        <div class="search_post-wrap">
                            <ul class="search_post-tabs">
                                <li class="tab">
                                    <a class="<?=$this->input->get('condition') == 'New' ? 'active' : ''?> waves-effect" href="<?=search_link_builder($this->input->get(), 'condition', 'New')?>">New Cars</a>
                                </li>
                                <li class="tab">
                                    <a class="<?= in_array($this->input->get('condition'), ['Foreign used', 'Nigerian used']) ? 'active' : ''?> waves-effect" id="condition-used-selector" href="Javascript:void(0)">Used Cars</a>
                                </li>
                            </ul>
                        </div>

                        <div id="newCars">
                            <ul class="collapsible expandable search_post_collapsible-wrap">
                                <li class="<?= in_array($this->input->get('condition'), ['Foreign used', 'Nigerian used']) ? 'show' : 'd-none'?> <?=!empty($_GET['condition']) ? 'active':''?>" id="condition-used-field">
                                    <div class="collapsible-header">Condition</div>
                                    <div class="collapsible-body search_post_collapsible-body">
                                        <ul class="search_post_collapsible-filter">
                                            <li><a href="<?=search_link_builder($this->input->get(),'condition', 'New')?>" >Select Condition</a></li>
                                            <li class="<?=$this->input->get('condition') == 'Foreign used' ? 'active' : ''?>"><a href="<?=search_link_builder($this->input->get(),'condition', 'Foreign used')?>" >Foreign used</a></li>
                                        </ul>

                                    </div>
                                </li>
                            </ul>
                            <h3 class="post-card-title">Basic</h3>
                            <div class="post-card-wrap">
                                <div class="search-select-style">
                                    <label for="state">State</label>
                                    <input id="state" autocomplete="off" placeholder="Search State..." class="browser-default search search_input" type="text">
                                    <i class="material-icons">arrow_drop_down</i>
                                    <ul class="search-list">
                                        <?=GlobalHelper::all_location_for_search()?>
                                    </ul>
                                </div>
                                <div class="search-select-style">
                                    <label for="location">Location</label>
                                    <input id="location" autocomplete="off" placeholder="Search Location.." class="browser-default search search_input" type="text">
                                    <i class="material-icons">arrow_drop_down</i>
                                    <ul class="search-list">
                                        <?=GlobalHelper::all_city_for_search($this->input->get('location'))?>
                                    </ul>
                                </div>
                                <div class="search-select-style">
                                    <label for="brand">Brand</label>
                                    <input id="brand" autocomplete="off" placeholder="Search brand.." class="browser-default search search_input" type="text">
                                    <i class="material-icons">arrow_drop_down</i>
                                    <ul class="search-list">
                                        <?=GlobalHelper::all_brand_for_search()?>
                                    </ul>
                                </div>
                                <div class="search-select-style">
                                    <label for="model">Model</label>
                                    <input id="model" autocomplete="off" placeholder="Search model.." class="browser-default search search_input" type="text">
                                    <i class="material-icons">arrow_drop_down</i>
                                    <ul class="search-list">
                                        <?=GlobalHelper::all_model_for_search()?>
                                    </ul>
                                </div>
                            </div>

                            <ul class="collapsible expandable search_post_collapsible-wrap">


                                <li class="<?=!empty($_GET['from_year']) || !empty($_GET['to_year']) ? 'active':''?>">
                                    <div class="collapsible-header">Year</div>
                                    <div class="collapsible-body search_post_collapsible-body">
                                        <div class="year-filter">
                                            <div class="filter-dropdown">
                                                <div class="select-dropdown-year d-flex align-items-center color-seconday">
                                                    <span class="select-value"> Min</span>
                                                    <span class="material-icons">
                                                            expand_more
                                                        </span>
                                                </div>
                                                <div class="dropdown">
                                                    <input placeholder="Search.." class="browser-default search" type="text">
                                                    <ul class="scrollbar search-list-year">
                                                        <li><a href="<?=search_link_builder($this->input->get(),'from_year', 0)?>">Min</a></li>
                                                        <?=GlobalHelper::yearRange_for_search()?>
                                                    </ul>
                                                </div>
                                            </div>

                                            <span class="to">to</span>
                                            <div class="filter-dropdown">
                                                <div class="select-dropdown-year d-flex align-items-center color-seconday">
                                                    <span class="select-value"> Max</span>
                                                    <span class="material-icons">
                                                            expand_more
                                                        </span>
                                                </div>
                                                <div class="dropdown">
                                                    <input placeholder="Search.." class="browser-default search" type="text">
                                                    <ul class="scrollbar search-list-year">
                                                        <li><a href="<?=search_link_builder($this->input->get(),'to_year', 0)?>">Max</a></li>
                                                        <?=GlobalHelper::yearRange_for_search('to_year')?>
                                                    </ul>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </li>
                                <li class="<?=!empty($_GET['price_from']) || !empty($_GET['price_to']) ? 'active':''?>">
                                    <div class="collapsible-header">Price</div>
                                    <div class="collapsible-body search_post_collapsible-body">
                                        <div class="year-filter">
                                            <div class="filter-dropdown">
                                                <div class="select-dropdown-year d-flex align-items-center color-seconday">
                                                    <span class="select-value"> Min</span>
                                                    <span class="material-icons">
                                                            expand_more
                                                        </span>
                                                </div>
                                                <div class="dropdown">
                                                    <div class="search-list">
                                                        <input placeholder="Search.." class="browser-default search"
                                                            type="text">
                                                    </div>
                                                    <ul class="scrollbar search-list-year">
                                                        <li><a href="<?=search_link_builder($this->input->get(),'price_from', 0)?>">Min</a></li>
                                                        <?=GlobalHelper::get_new_price_for_search('price_from')?>
                                                    </ul>
                                                </div>
                                            </div>

                                            <span class="to">to</span>
                                            <div class="filter-dropdown">
                                                <div class="select-dropdown-year d-flex align-items-center color-seconday">
                                                    <span class="select-value"> Max</span>
                                                    <span class="material-icons">
                                                            expand_more
                                                        </span>
                                                </div>
                                                <div class="dropdown">
                                                    <div class="search-list">
                                                        <input placeholder="Search.." class="browser-default search"
                                                            type="text">
                                                    </div>
                                                    <ul class="scrollbar search-list-year">
                                                        <li><a href="<?=search_link_builder($this->input->get(),'price_to', 0)?>">Max</a></li>
                                                        <?=GlobalHelper::get_new_price_for_search('price_to')?>
                                                    </ul>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                </li>

                            </ul>
                            <?php if (in_array($vehicle_type_id, [1, 3])) {?>
                            <h3 class="post-card-title">Style</h3>
                            <div class="post-card-wrap bg-none">
                                <div class="search-select-style">
                                    <label for="transmission">Transmission</label>
                                    <input id="transmission" autocomplete="off" placeholder="Search transmission..." class="browser-default search search_input" type="text">
                                    <i class="material-icons">arrow_drop_down</i>
                                    <ul class="search-list">
                                        <?=GlobalHelper::transmission_for_search()?>
                                    </ul>
                                </div>
                                <div class="search-select-style">
                                    <label for="engine">Engine</label>
                                    <input id="engine" autocomplete="off" placeholder="Search engine..." class="browser-default search search_input" type="text">
                                    <i class="material-icons">arrow_drop_down</i>
                                    <ul class="search-list">
                                        <?=GlobalHelper::engine_search_for_search()?>
                                    </ul>
                                </div>
                                <div class="search-select-style">
                                    <label for="fuel_type">Fuel Type</label>
                                    <input id="fuel_type" autocomplete="off" placeholder="Search Fuel Type..." class="browser-default search search_input" type="text">
                                    <i class="material-icons">arrow_drop_down</i>
                                    <ul class="search-list">
                                        <?=GlobalHelper::fuel_type_for_search()?>
                                    </ul>
                                </div>
                                <div class="search-select-style">
                                    <label for="color">Color</label>
                                    <input id="color" autocomplete="off" placeholder="Search color..." class="browser-default search search_input" type="text">
                                    <i class="material-icons">arrow_drop_down</i>
                                    <ul class="search-list">
                                        <?=GlobalHelper::color_for_search()?>
                                    </ul>
                                </div>

                            </div>
                            <?php } ?>

                        </div>
                    </div>
                </aside>
            </div>
            <div class="col-xl-9 col-lg-8 col-12">
                <h1 class="fs-24 fw-500 mb-15"><?=$meta_title?></h1>
                <div class="search_post-filter-wrap">
                    <?php
                    $end_page_count = !empty($this->input->get('page')) ? $this->input->get('page') * 30 : 30;
                    if ($end_page_count > $total){
                        $end_page_count = $total;
                    }
                    ?>
                    <h2 class="fs-16 fw-500 color-seconday mb-0">Showing From <?=!empty($this->input->get('page')) ? ($this->input->get('page')-1) * 30 : 0?> To <?=$end_page_count?> of <?=number_format($total)?> Results</h2>
                    <div class="search_post-filter">
                        <div class="dropdown-profile shortby" data-target="dropdown">
                             Sort By
                             <i class="material-icons">arrow_drop_down</i>
						</div>
                        <ul class="search_post-filter-dropdown dropdown-content" id="dropdown">
                            <?php echo GlobalHelper::get_short_for_search()?>
                        </ul>
                        <button class="btnStyle btnStyleOutline waves-effect"><a href="<?='buy/'.$this->uri->segment(2). '/'.$this->uri->segment(3)?>">Refresh Listing</a> </button>
                    </div>
                </div>
                <div class="row">
                    <?php
//                    pp($html);
//                    $post_slug = $this->uri->segment(2);
//                    echo Modules::run('posts/posts_frontview/getPosts', $post_slug );
                    echo $html;
                    ?>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(".search-select-style ul li").each((id, elem) => {
        if($(elem).hasClass('active')){
            $(elem).parents('.search-select-style').find('.search_input').val($(elem).text().trim())
        }
    });
    $(".search-list-year li").each((id, elem) => {
        if($(elem).hasClass('active')){
            $(elem).parents('.filter-dropdown').find('.select-value').text($(elem).text().trim())
        }
    });
    $('.search_post-tabs li a').on('click', function () {
        $('.search_post-tabs li a').removeClass('active');
        $(this).addClass('active');
    })

    $(document).on('click', '.search_post-form li .select-dropdown', function () {
        $(this).parent('.search_post-form li').toggleClass('active');
        $('.backdrop-body').show()

    })
    $('.search-select-style').on('click',function(){
        $(this).toggleClass('active');
    })
    $(".search").on("keyup", function () {
        let value = $(this).val().toLowerCase();
        $(this).parent('.search-select-style').find(".search-list li").filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    });
    $('.search-list li a').on('click', function () {
        let selectText = $(this).text();
        $('.search-list li a').removeClass('selected')
        $(this).addClass('selected')
        $(this).parents('.search_post-form li').find('.select-value').text(selectText)
    })
    $(document).ready(function (){
        $('.search-list li a').each(function (e, i){
            if ($(i).hasClass('selected')){
                $(i).parents('.search_post-form li').find('.select-value').text($(i).text())
            }

        })

        $('.search-list-year li a').each(function (e, i){
            if ($(i).hasClass('selected')){
                $(i).parents('.filter-dropdown').find('.select-value').text($(i).text())
            }

        })
    })
    $(document).on('click', '.select-dropdown-year', function () {
        $(this).parent('.filter-dropdown').toggleClass('active');
        $('.backdrop-body').show()
        $(".search").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $(".search-list-year li").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    })

    $('.search-list-year li a').on('click', function () {
        let selectText = $(this).text();
        $('.search-list-year li a').removeClass('selected')
        $(this).addClass('selected')
        $(this).parents('.filter-dropdown').find('.select-value').text(selectText)
    })

    $(document).on('click', '.backdrop-body', function () {
        $('.search_post-form li').removeClass('active');
        $('.filter-dropdown').removeClass('active');
        $(this).hide()
    })

    $(".checkedAll").change(function () {
        if (this.checked) {
            $(this).parents('.search_post_collapsible-body').find(".checkSingle").each(function () {
                this.checked = true;
            })
        } else {
            $(this).parents('.search_post_collapsible-body').find(".checkSingle").each(function () {
                this.checked = false;
            })
        }
    });

    $(".checkSingle").click(function () {
        if ($(this).is(":checked")) {
            var isAllChecked = 0;
            $(this).parents('.search_post_collapsible-body').find(".checkSingle").each(function () {
                if (!this.checked)
                    isAllChecked = 1;
            })
            if (isAllChecked == 0) { $(".checkedAll").prop("checked", true); }
        } else {
            $(".checkedAll").prop("checked", false);
        }
    });


    $('#condition-used-selector').on('click', function (){
        $('#condition-used-field').removeClass('d-none');
        $('#condition-used-field').addClass('show');
    })

    $('.search-list-show-extra').on('click', function () {
        $(this).toggleClass('active');
        if ($(this).hasClass('active')){
            $(this).prev().css({'height' : 'auto'});
            $(this).text('Show Less')
        } else {
            $(this).prev().css({'height' : '200px'});
            $(this).text('Show More')
        }

    })
</script>
